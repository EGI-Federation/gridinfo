{%extends "base_gstat.html"%}

{% block breadcrumbs %}<a href="/gstat/">Home</a> :: <a href="/gstat/geo">Geo</a> :: <a href="/gstat/geo/openlayers">Open Layers</a>{% endblock %}

{% block css-add %}
    <link rel="stylesheet" href="/media/geo/css/openlayers.css" type="text/css" />
{% endblock %}

{% block scripts-add %}
    <script src="/media/geo/scripts/OpenLayers.js" type="text/javascript"></script>
    <script src="/media/geo/scripts/gstat-openlayers.js" type="text/javascript"></script>
{% endblock %}

{% block bodyparams %}onload="init()"{% endblock %}

{% block content-main %}
    <div style='width: 940px; height:400px;' id="map" class="smallmap"></div>
	<div>
	    <p>
	      Other options:<br />
	      <a href='/gstat/geo/gmap'>View it with Google Maps</a><br />
	      <a id='kmllink' href='/gstat/geo/kml'>Download filtered KML</a><br />
	      <a href='/gstat/geo/kml'>Download all KML</a><br />
	    </p>
	</div>
    <script type="text/javascript">
        function changeFilterValue(event) {
            kmllink = document.getElementById('kmllink');
            filtertype = document.getElementById('filtertype');
            filtervalue = document.getElementById('filtervalue');
            kmlurl = "/gstat/geo/kml/" + filtertype.value + '/' + filtervalue.value;
            kmllink.pathname = kmlurl;
            map.removeLayer(sundials);
            sundials = new OpenLayers.Layer.Vector("The Grid", {
                projection: map.displayProjection,
                strategies: [new OpenLayers.Strategy.Fixed()],
                protocol: new OpenLayers.Protocol.HTTP({
                    url: kmlurl,
                    format: new OpenLayers.Format.KML({
                        extractStyles: true,
                        extractAttributes: true
                    })
                })
            });
            map.addLayer(sundials);
            return true;
        }
    </script>
{% endblock %}
